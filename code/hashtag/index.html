<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pills </title>
   <style>

       #content-div .tag {
 
           font-weight: 600;
       
       }

       #content-div .tag a{
           padding: 3px; 
           border: 1px sloid #eee;
           font-weight: 600;
           border-radius: 2px;
           text-decoration: none;
       }

   </style>

</head>
<body>

<div id="app"> <!--作用范围 #app -->
        

         
 
    <ul>
        <li v-for="pill in pills">
          
            <span>{{pill.datetime}}</span>
            
            <p id="content-div"> {{ pill.content }}</p>

        </li>
    </ul>

  

</div>
 




    <!-------- axios 请求-------->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-------- Vue 组件-------->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script type="text/javascript" src="./hashtag.js"></script>
    <script>
  


        var app = new Vue({

            el: '#app',

            data: {
               
                pills:{},
                tag:'',
            },

            created(){
                //自动加载get方法
                this.get();
         
            },

            methods:{
                get:function(){
                    var outter = this;

                    if(outter.getQueryVariable('tag')!=''){
                        tag = decodeURI(outter.getQueryVariable('tag'));
                        url = "./api.php?tag="+tag;
                        // console.log(url);
                    }else if(outter.getQueryVariable('tag')==''){
                        url = "./api.php";
                    }

      
                        axios.get(url).then(function(response){
                             outter.pills = response.data;
                             outter.$nextTick(() =>{
                             outter.hashtag('#content-div');
                             outter.tag = decodeURI((outter.getQueryVariable('tag')));
                            });

                        }),function(err){
                            console.log(err);
                        }
                
           
                },

                hashtag:function(div){
                    Hashtag.setOptions({
                        templates: {
                            'timecho': '<a class="tag" href="?tag={#n}">{#}</a>',
                        }
                    });
 
                    content = Hashtag.replaceTags(div,'timecho');
                },

                getPillsByTag:function(){
                   alert(this.tag);
                },

                getQueryVariable:function(variable){
                    var query = window.location.search.substring(1);
                    var vars = query.split("&");
                    for (var i=0;i<vars.length;i++) {
                        var pair = vars[i].split("=");
                        if(pair[0] == variable){return pair[1];}
                    }
                    return(false);
                }

 
               
            }

        })

       

    </script>



</body>
</html>